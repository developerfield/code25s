<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KÃ¼mÃ¼latif Veri Takip</title>
<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
<style>
*{box-sizing:border-box;margin:0;padding:0}body{font-family:'Inter',Arial,sans-serif;padding:10px;background-color:#f4f7f9}.container{display:flex;gap:20px;margin-bottom:20px;flex-wrap:wrap;justify-content:center}.data-section{background-color:white;border:1px solid #ddd;padding:20px;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,0.08);width:100%;max-width:400px}h1{color:#2c3e50;margin-bottom:20px;text-align:center;font-size:24px}h3{color:#34495e;border-bottom:2px solid #ecf0f1;padding-bottom:10px;margin-top:0;margin-bottom:15px;font-size:18px}.button-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:15px}.button-grid button{padding:15px;font-size:16px;cursor:pointer;border:none;border-radius:8px;transition:all 0.2s;font-weight:bold;background-color:#ecf0f1}.button-grid button:hover{background-color:#bdc3c7;transform:translateY(-2px)}.button-grid button:active{transform:translateY(0)}#save-button{margin-top:20px;padding:12px 25px;background-color:#2ecc71;color:white;border:none;border-radius:8px;cursor:pointer;width:100%;font-size:17px;transition:background-color 0.2s;box-shadow:0 4px #27ae60}#save-button:active{box-shadow:0 1px #27ae60;transform:translateY(3px)}.action-btn{padding:12px 25px;color:white;border:none;border-radius:8px;cursor:pointer;width:100%;font-size:17px;transition:background-color 0.2s;margin-bottom:10px}.action-btn.blue{background-color:#3498db;box-shadow:0 4px #2980b9}.action-btn.blue:active{box-shadow:0 1px #2980b9;transform:translateY(3px)}.action-btn.purple{background-color:#9b59b6;box-shadow:0 4px #8e44ad}.action-btn.purple:active{box-shadow:0 1px #8e44ad;transform:translateY(3px)}.action-btn.red{background-color:#e74c3c;box-shadow:0 4px #c0392b}.action-btn.red:active{box-shadow:0 1px #c0392b;transform:translateY(3px)}.action-btn.orange{background-color:#e67e22;box-shadow:0 4px #d35400}.action-btn.orange:active{box-shadow:0 1px #d35400;transform:translateY(3px)}.action-btn.green{background-color:#27ae60;box-shadow:0 4px #229954}.action-btn.green:active{box-shadow:0 1px #229954;transform:translateY(3px)}#current-cumulative-value{font-size:20px;font-weight:bold;margin-top:15px;text-align:center;color:#e74c3c;padding:10px;border:2px dashed #e74c3c;border-radius:8px}input[type="date"],input[type="number"]{padding:10px;font-size:16px;border:1px solid #ccc;border-radius:6px;width:100%;margin-bottom:15px}#selected-value{font-size:20px;color:#2980b9;display:block;margin-bottom:15px}.modal{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:rgba(0,0,0,0.5)}.modal-content{background-color:#fefefe;margin:2% auto;padding:20px;border-radius:12px;width:90%;max-width:1200px;box-shadow:0 8px 24px rgba(0,0,0,0.2);max-height:90vh;overflow-y:auto}.close-modal{color:#aaa;float:right;font-size:32px;font-weight:bold;cursor:pointer;line-height:20px}.close-modal:hover,.close-modal:focus{color:#000}.modal-chart-wrapper{position:relative;height:350px;margin:20px 0}.date-range-control{display:flex;gap:10px;align-items:center;justify-content:center;margin-bottom:20px;flex-wrap:wrap}.range-btn{padding:8px 16px;background-color:#3498db;color:white;border:none;border-radius:6px;cursor:pointer;font-size:14px;transition:background-color 0.2s}.range-btn:hover{background-color:#2980b9}.range-btn:active{transform:translateY(2px)}#days-range-input{padding:8px;font-size:14px;border:2px solid #3498db;border-radius:6px;width:120px;text-align:center}.chart-title{text-align:center;color:#2c3e50;margin-bottom:15px;font-size:16px}.bonus-control{background-color:#f8f9fa;padding:15px;border-radius:8px;margin-top:15px;border:1px solid #ddd}.bonus-control label{display:block;font-weight:bold;margin-bottom:8px;color:#2c3e50}.trend-box{background-color:#ecf0f1;padding:15px;border-radius:8px;margin:10px 0;border-left:4px solid #3498db;font-size:14px}.trend-up{border-left-color:#2ecc71;color:#27ae60}.trend-down{border-left-color:#e74c3c;color:#c0392b}.s-parameter-control{background-color:#f8f9fa;padding:15px;border-radius:8px;border:2px solid #3498db;display:flex;align-items:center;gap:8px;margin:15px 0}.s-parameter-control label{font-weight:bold;color:#2c3e50;font-size:16px;margin:0}.s-parameter-control input{padding:8px 12px;font-size:16px;border:2px solid #3498db;border-radius:6px;width:80px;text-align:center}.calc-results{background-color:#ecf0f1;padding:20px;border-radius:8px;margin:20px 0}.calc-results h4{color:#2c3e50;margin-bottom:15px}.calc-item{padding:10px;margin:8px 0;background-color:white;border-radius:6px;border-left:4px solid #3498db;font-size:15px}.slope-display{background-color:#fff3cd;padding:15px;border-radius:8px;border-left:4px solid #ffc107;font-size:16px;font-weight:bold;color:#856404;margin:10px 0}.today-value-display{background-color:#d1ecf1;padding:15px;border-radius:8px;border-left:4px solid #17a2b8;font-size:16px;font-weight:bold;color:#0c5460;margin:10px 0}.missing-dates-container{background-color:#fff3cd;padding:20px;border-radius:8px;margin-top:20px;border-left:4px solid #ffc107}.missing-dates-list{display:flex;flex-wrap:wrap;gap:8px}.missing-date-item{background-color:white;padding:6px 12px;border-radius:4px;font-size:13px;color:#856404;border:1px solid #ffc107}.prediction-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:15px;margin:20px 0}.prediction-card{background-color:white;padding:15px;border-radius:8px;border-left:4px solid #3498db;box-shadow:0 2px 8px rgba(0,0,0,0.1)}.prediction-card h5{color:#2c3e50;margin-bottom:10px;font-size:14px}.prediction-card .value{font-size:18px;font-weight:bold;color:#e74c3c}.calendar-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:5px;margin:20px 0}.calendar-day{padding:15px 5px;text-align:center;border-radius:6px;font-size:13px;cursor:pointer;border:1px solid #ddd;transition:transform 0.2s}.calendar-day:hover{transform:scale(1.05)}.calendar-day.empty{background-color:#f8f9fa;border:none;cursor:default}.calendar-day.no-data{background-color:#95a5a6;color:white}.calendar-day.v125{background-color:#9b59b6;color:white}.calendar-day.v1{background-color:#3498db;color:white}.calendar-day.v075{background-color:#2ecc71;color:white}.calendar-day.v025{background-color:#a9dfbf;color:#2c3e50}.calendar-day.v0{background-color:#f9e79f;color:#2c3e50}.calendar-day.vm025{background-color:#f8b878;color:#2c3e50}.calendar-day.vm075{background-color:#e67e22;color:white}.calendar-day.vm1{background-color:#ec7063;color:white}.calendar-day.vm125{background-color:#e74c3c;color:white}.calendar-header{text-align:center;margin:20px 0;display:flex;justify-content:space-between;align-items:center}.calendar-header button{padding:8px 16px;background-color:#3498db;color:white;border:none;border-radius:6px;cursor:pointer}.calendar-weekdays{display:grid;grid-template-columns:repeat(7,1fr);gap:5px;margin-bottom:10px;font-weight:bold;text-align:center}.calendar-weekdays div{padding:10px 5px;color:#2c3e50}@media (max-width:768px){.container{flex-direction:column}.data-section{max-width:none}h1{font-size:20px}.button-grid button{padding:12px;font-size:14px}.modal-content{width:95%;margin:5% auto;padding:15px}.modal-chart-wrapper{height:300px}.prediction-grid{grid-template-columns:1fr}}
</style>
</head>
<body>
<h1>ğŸ“… KÃ¼mÃ¼latif Veri Kaydedici</h1>
<div style="text-align:center;color:#7f8c8d;font-size:14px;margin-bottom:15px;">
<span id="days-passed"></span>
</div>
<div class="container">
<div class="data-section">
<h3>Veri GiriÅŸi</h3>
<label for="date-picker" style="font-weight:bold;">Tarih SeÃ§in:</label>
<input type="date" id="date-picker" required>
<span style="display:block;font-weight:bold;">SeÃ§ilen DeÄŸer:</span>
<strong id="selected-value">0.00</strong>
<div class="button-grid" id="button-container"></div>
<button id="save-button" onclick="saveData()">ğŸ’¾ SeÃ§ilen DeÄŸeri Kaydet</button>
<button class="action-btn blue" onclick="openCalendarModal()" style="margin-top:10px;">ğŸ“… DeÄŸer Takvimini GÃ¶ster</button>
<p id="save-status" style="color:#27ae60;font-weight:bold;text-align:center;margin-top:10px;"></p>
</div>
<div class="data-section">
<h3>Grafik & Analiz</h3>
<button class="action-btn blue" onclick="openChartsModal()">ğŸ“Š TÃ¼m Grafikleri GÃ¶ster</button>
<button class="action-btn red" onclick="openSpecialCalculation()">ğŸ”¬ Ã–zel Hesaplama GrafiÄŸi</button>
<button class="action-btn orange" onclick="toggleTrendVisibility()"><span id="trend-text">ğŸ‘ï¸ Trend Analizini GÃ¶ster</span></button>
<button class="action-btn purple" onclick="window.open('https://www.google.com','_blank')">ğŸŒ Harici Siteye Git</button>
<button class="action-btn green" onclick="openPredictionModal()">ğŸ”® Gelecek Verileri Tahmin Et</button>
<div id="current-cumulative-value"></div>
<div class="bonus-control">
<label for="bonus-input">Grafik 3 & 4 Bonus DeÄŸeri:</label>
<input type="number" id="bonus-input" value="0.5" step="0.1" min="0" max="5" onchange="generateChart()">
<p style="font-size:12px;color:#7f8c8d;margin-top:5px;">Bu deÄŸer 3. ve 4. grafiklere eklenecek</p>
</div>
</div>
</div>
<div id="trend-container" style="display:none;background-color:white;padding:20px;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,0.08);margin:20px auto;max-width:800px;">
<h3 style="text-align:center;color:#2c3e50;margin-bottom:20px;">ğŸ“Š Trend Analizi</h3>
<div id="trend-analysis"></div>
</div>
<div id="charts-modal" class="modal">
<div class="modal-content">
<span class="close-modal" onclick="closeChartsModal()">&times;</span>
<h2 style="text-align:center;color:#2c3e50;margin-bottom:20px;">ğŸ“Š TÃ¼m Grafikler</h2>
<div class="bonus-control" style="max-width:400px;margin:0 auto 20px;">
<label for="bonus-input-modal">Grafik 3 & 4 Bonus DeÄŸeri:</label>
<input type="number" id="bonus-input-modal" value="0.5" step="0.1" min="0" max="5" onchange="updateBonusAndRender()">
<p style="font-size:12px;color:#7f8c8d;margin-top:5px;">Bu deÄŸer 3. ve 4. grafiklere eklenecek</p>
</div>
<div class="date-range-control">
<button class="range-btn" onclick="adjustChartRange(-30)">Zoom -30</button>
<button class="range-btn" onclick="adjustChartRange(-10)">Zoom -10</button>
<input type="number" id="chart-days-input" value="0" min="0" placeholder="Zoom (0=tÃ¼mÃ¼)">
<button class="range-btn" onclick="adjustChartRange(10)">Zoom +10</button>
<button class="range-btn" onclick="adjustChartRange(30)">Zoom +30</button>
</div>
<div class="date-range-control" style="margin-top:10px;">
<button class="range-btn" onclick="shiftChartView(-30)">&lt; -30 GÃ¼n</button>
<button class="range-btn" onclick="shiftChartView(-10)">&lt; -10 GÃ¼n</button>
<input type="number" id="chart-offset-input" value="0" min="0" placeholder="KaydÄ±rma">
<button class="range-btn" onclick="shiftChartView(10)">+10 GÃ¼n &gt;</button>
<button class="range-btn" onclick="shiftChartView(30)">+30 GÃ¼n &gt;</button>
</div>
<div>
<h3 class="chart-title">Grafik 1: KÃ¼mÃ¼latif Toplam</h3>
<div class="modal-chart-wrapper"><canvas id="cumulativeChart"></canvas></div>
</div>
<div>
<h3 class="chart-title">Grafik 2: GÃ¼nlÃ¼k DeÄŸerler</h3>
<div class="modal-chart-wrapper"><canvas id="dailyChart"></canvas></div>
</div>
<div>
<h3 class="chart-title">Grafik 3: KÃ¼mÃ¼latif Toplam (+Bonus)</h3>
<div class="modal-chart-wrapper"><canvas id="cumulativePlusChart"></canvas></div>
</div>
<div>
<h3 class="chart-title">Grafik 4: GÃ¼nlÃ¼k DeÄŸerler (+Bonus)</h3>
<div class="modal-chart-wrapper"><canvas id="dailyPlusChart"></canvas></div>
</div>
</div>
</div>
<div id="special-calc-modal" class="modal">
<div class="modal-content">
<span class="close-modal" onclick="closeSpecialCalculation()">&times;</span>
<h2 style="text-align:center;color:#2c3e50;margin-bottom:20px;">ğŸ”¬ Ã–zel Hesaplama GrafiÄŸi</h2>
<div class="date-range-control">
<button class="range-btn" onclick="adjustSpecialRange(-30)">Zoom -30</button>
<button class="range-btn" onclick="adjustSpecialRange(-10)">Zoom -10</button>
<input type="number" id="days-range-input" value="0" min="0" placeholder="Zoom (0=tÃ¼mÃ¼)">
<button class="range-btn" onclick="adjustSpecialRange(10)">Zoom +10</button>
<button class="range-btn" onclick="adjustSpecialRange(30)">Zoom +30</button>
</div>
<div class="date-range-control" style="margin-top:10px;">
<button class="range-btn" onclick="shiftSpecialView(-30)">&lt; -30 GÃ¼n</button>
<button class="range-btn" onclick="shiftSpecialView(-10)">&lt; -10 GÃ¼n</button>
<input type="number" id="special-offset-input" value="0" min="0" placeholder="KaydÄ±rma">
<button class="range-btn" onclick="shiftSpecialView(10)">+10 GÃ¼n &gt;</button>
<button class="range-btn" onclick="shiftSpecialView(30)">+30 GÃ¼n &gt;</button>
</div>
<div class="modal-chart-wrapper"><canvas id="specialCalcChart"></canvas></div>
<div style="display:flex;gap:15px;flex-wrap:wrap;">
<div class="slope-display" style="flex:1;" id="slope-display"></div>
<div class="today-value-display" style="flex:1;" id="today-value-display"></div>
</div>
<div class="modal-chart-wrapper" style="margin-top:30px;"><canvas id="specialCalcChart2"></canvas></div>
<div style="display:flex;gap:15px;flex-wrap:wrap;align-items:center;">
<div class="s-parameter-control" style="flex:0 0 auto;">
<label for="s-parameter-input">DeÄŸer:</label>
<input type="number" id="s-parameter-input" value="12" step="0.1" onchange="renderSpecialCharts()">
</div>
<div class="slope-display" style="flex:1;" id="slope-display-2"></div>
<div class="today-value-display" style="flex:1;" id="today-value-display-2"></div>
</div>
<div class="calc-results">
<h4>ğŸ“Š BugÃ¼nÃ¼n HesaplamalarÄ±</h4>
<div class="calc-item" id="calc-result-1"></div>
<div class="calc-item" id="calc-result-2"></div>
</div>
<div class="missing-dates-container">
<h4 style="color:#2c3e50;margin-bottom:15px;">ğŸ“… Veri Girilmeyen Tarihler</h4>
<div id="missing-dates-list" class="missing-dates-list"></div>
</div>
</div>
</div>
<div id="prediction-modal" class="modal">
<div class="modal-content">
<span class="close-modal" onclick="closePredictionModal()">&times;</span>
<h2 style="text-align:center;color:#2c3e50;margin-bottom:20px;">ğŸ”® Gelecek Veri Tahminleri</h2>
<div id="prediction-content"></div>
</div>
</div>
<div id="calendar-modal" class="modal">
<div class="modal-content">
<span class="close-modal" onclick="closeCalendarModal()">&times;</span>
<h2 style="text-align:center;color:#2c3e50;margin-bottom:20px;">ğŸ“… DeÄŸer Takvimi</h2>
<div class="calendar-header">
<button onclick="changeMonth(-1)">â† Ã–nceki Ay</button>
<h3 id="calendar-month"></h3>
<button onclick="changeMonth(1)">Sonraki Ay â†’</button>
</div>
<div class="calendar-weekdays">
<div>Pzt</div><div>Sal</div><div>Ã‡ar</div><div>Per</div><div>Cum</div><div>Cmt</div><div>Paz</div>
</div>
<div id="calendar-grid" class="calendar-grid"></div>
<div style="margin-top:20px;padding:15px;background-color:#f8f9fa;border-radius:8px;">
<h4 style="margin-bottom:10px;color:#2c3e50;">Renk AÃ§Ä±klamalarÄ±:</h4>
<div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:8px;font-size:13px;">
<div style="display:flex;align-items:center;gap:6px;"><div style="width:18px;height:18px;background-color:#95a5a6;border-radius:3px;"></div><span>Veri Yok</span></div>
<div style="display:flex;align-items:center;gap:6px;"><div style="width:18px;height:18px;background-color:#9b59b6;border-radius:3px;"></div><span>1.25 (Mor)</span></div>
<div style="display:flex;align-items:center;gap:6px;"><div style="width:18px;height:18px;background-color:#3498db;border-radius:3px;"></div><span>1 (Mavi)</span></div>
<div style="display:flex;align-items:center;gap:6px;"><div style="width:18px;height:18px;background-color:#2ecc71;border-radius:3px;"></div><span>0.75 (YeÅŸil)</span></div>
<div style="display:flex;align-items:center;gap:6px;"><div style="width:18px;height:18px;background-color:#a9dfbf;border-radius:3px;"></div><span>0.25</span></div>
<div style="display:flex;align-items:center;gap:6px;"><div style="width:18px;height:18px;background-color:#f9e79f;border-radius:3px;"></div><span>0 (SarÄ±)</span></div>
<div style="display:flex;align-items:center;gap:6px;"><div style="width:18px;height:18px;background-color:#f8b878;border-radius:3px;"></div><span>-0.25</span></div>
<div style="display:flex;align-items:center;gap:6px;"><div style="width:18px;height:18px;background-color:#e67e22;border-radius:3px;"></div><span>-0.75</span></div>
<div style="display:flex;align-items:center;gap:6px;"><div style="width:18px;height:18px;background-color:#ec7063;border-radius:3px;"></div><span>-1</span></div>
<div style="display:flex;align-items:center;gap:6px;"><div style="width:18px;height:18px;background-color:#e74c3c;border-radius:3px;"></div><span>-1.25 (KÄ±rmÄ±zÄ±)</span></div>
</div>
</div>
</div>
</div>
<div id="edit-value-modal" class="modal">
<div class="modal-content" style="max-width:400px;">
<span class="close-modal" onclick="closeEditValueModal()">&times;</span>
<h2 style="text-align:center;color:#2c3e50;margin-bottom:20px;">DeÄŸeri DÃ¼zenle</h2>
<div style="text-align:center;margin-bottom:15px;">
<strong style="font-size:18px;color:#2980b9;" id="edit-date-display"></strong>
</div>
<div style="text-align:center;margin-bottom:15px;">
<strong style="font-size:16px;">SeÃ§ilen DeÄŸer: <span id="edit-selected-value" style="color:#e74c3c;">0.00</span></strong>
</div>
<div class="button-grid" id="edit-button-container"></div>
<button class="action-btn green" onclick="saveEditedValue()" style="margin-top:15px;">ğŸ’¾ DeÄŸeri Kaydet</button>
<button class="action-btn red" onclick="deleteValue()" style="margin-top:10px;">ğŸ—‘ï¸ DeÄŸeri Sil</button>
</div>
</div>
<script>
const firebaseConfig={apiKey:"AIzaSyAIGzwmEB9F7K7KQzsEU5etVWejZ3oSluc",authDomain:"paralayici.firebaseapp.com",projectId:"paralayici",storageBucket:"paralayici.firebasestorage.app",messagingSenderId:"980843550614",appId:"1:980843550614:web:93dd5bda4ddc377b20efb7"};
let db,chartInstance1=null,chartInstance2=null,chartInstance3=null,chartInstance4=null,specialChartInstance=null,specialChartInstance2=null,trendVisible=false,currentDaysRange=0,currentDaysOffset=0,chartDaysRange=0,chartDaysOffset=0,allSpecialData=null,allChartData=null,calendarMonth=new Date(),calendarData=null;
const buttonValues=[-1.25,-0.25,0.75,-1,0,1,-0.75,0.25,1.25],collectionName="cumulative_daily_data";
let selectedValue=0;
try{firebase.initializeApp(firebaseConfig);db=firebase.firestore();console.log("Firebase baÅŸlatÄ±ldÄ±.");document.getElementById('date-picker').valueAsDate=new Date();const startDate=new Date('2015-06-14'),today=new Date(),diffTime=Math.abs(today-startDate),diffDays=Math.ceil(diffTime/(1000*60*60*24));document.getElementById('days-passed').textContent=`14 Haziran 2015'ten bu gÃ¼ne ${diffDays} gÃ¼n geÃ§ti`;}catch(e){console.error("Firebase hatasÄ±:",e);document.body.innerHTML="<h1>Hata</h1><p>Firebase yapÄ±landÄ±rma hatasÄ±.</p>";}
function setupButtons(){const container=document.getElementById('button-container');container.innerHTML='';buttonValues.forEach(value=>{const button=document.createElement('button');button.textContent=value.toFixed(2);button.onclick=()=>selectValue(value);container.appendChild(button);});}
function selectValue(value){selectedValue=value;document.getElementById('selected-value').textContent=value.toFixed(2);}
function alertMessage(message,color){const statusElement=document.getElementById('save-status');statusElement.textContent=message;statusElement.style.color=color;setTimeout(()=>statusElement.textContent='',4000);}
async function saveData(){if(!db)return alertMessage("Firebase baÅŸlatÄ±lamadÄ±.",'red');const dateInput=document.getElementById('date-picker'),date=dateInput.value;if(!date){alertMessage("LÃ¼tfen bir tarih seÃ§in.",'red');return;}try{await db.collection(collectionName).doc(date).set({date:date,value:selectedValue,timestamp:firebase.firestore.FieldValue.serverTimestamp()});alertMessage(`âœ… ${date} iÃ§in ${selectedValue.toFixed(2)} kaydedildi!`,'green');generateChart();}catch(error){console.error("Veri kayÄ±t hatasÄ±:",error);alertMessage(`âŒ KayÄ±t hatasÄ±`,'red');}}
function toggleTrendVisibility(){trendVisible=!trendVisible;const container=document.getElementById('trend-container'),buttonText=document.getElementById('trend-text');if(trendVisible){container.style.display='block';buttonText.textContent='ğŸ‘ï¸ Trend Analizini Gizle';}else{container.style.display='none';buttonText.textContent='ğŸ‘ï¸ Trend Analizini GÃ¶ster';}}
function calculateTrend(data){if(data.length<2)return{direction:'neutral',percentage:0};const sum=data.reduce((a,b)=>a+b,0),avg=sum/data.length,recentSum=data.slice(-Math.max(1,Math.floor(data.length/2))).reduce((a,b)=>a+b,0),recentAvg=recentSum/Math.max(1,Math.floor(data.length/2)),change=((recentAvg-avg)/Math.abs(avg||1))*100;if(Math.abs(change)<5)return{direction:'stable',percentage:change};return{direction:change>0?'up':'down',percentage:change};}
function analyzeTrends(dailyValues){const n=dailyValues.length;if(n<2)return '<p style="text-align:center;color:#7f8c8d;">Trend analizi iÃ§in yeterli veri yok.</p>';const half=Math.floor(n/2),quarter=Math.floor(n/4),sixteenth=Math.floor(n/16),fullData=dailyValues,lastHalf=dailyValues.slice(-half),lastQuarter=dailyValues.slice(-quarter),lastSixteenth=sixteenth>0?dailyValues.slice(-sixteenth):dailyValues.slice(-1),fullTrend=calculateTrend(fullData),halfTrend=calculateTrend(lastHalf),quarterTrend=calculateTrend(lastQuarter),sixteenthTrend=calculateTrend(lastSixteenth);function getTrendText(trend,label){let icon='ğŸ“Š',className='',text='';if(trend.direction==='up'){icon='ğŸ“ˆ';className='trend-up';text=`<strong>${label}:</strong> ArtÄ±ÅŸ trendinde (${trend.percentage.toFixed(1)}% yÃ¼kseliÅŸ)`;}else if(trend.direction==='down'){icon='ğŸ“‰';className='trend-down';text=`<strong>${label}:</strong> AzalÄ±ÅŸ trendinde (${Math.abs(trend.percentage).toFixed(1)}% dÃ¼ÅŸÃ¼ÅŸ)`;}else{icon='â¡ï¸';text=`<strong>${label}:</strong> Stabil trend (${trend.percentage.toFixed(1)}% deÄŸiÅŸim)`;}return `<div class="trend-box ${className}">${icon} ${text}</div>`;}return `${getTrendText(fullTrend,'TÃ¼m Veriler')}${getTrendText(halfTrend,`Son YarÄ± (${half} gÃ¼n)`)}${getTrendText(quarterTrend,`Son Ã‡eyrek (${quarter} gÃ¼n)`)}${getTrendText(sixteenthTrend,`Son 1/16 (${lastSixteenth.length} gÃ¼n)`)}`;}
async function generateChart(){if(!db)return;const snapshot=await db.collection(collectionName).orderBy("date","asc").get();if(snapshot.empty){if(chartInstance1)chartInstance1.destroy();if(chartInstance2)chartInstance2.destroy();if(chartInstance3)chartInstance3.destroy();if(chartInstance4)chartInstance4.destroy();document.getElementById('current-cumulative-value').innerHTML='**BugÃ¼nkÃ¼ KÃ¼mÃ¼latif DeÄŸer:** 0.00 (Veri Yok)';document.getElementById('trend-analysis').innerHTML='<p style="text-align:center;color:#7f8c8d;">Veri yok.</p>';return;}const bonusValue=parseFloat(document.getElementById('bonus-input').value)||0.5,allData=[];snapshot.forEach(doc=>allData.push(doc.data()));let cumulativeSum=0,cumulativeSumPlusBonus=0;const labels=[],dailyValues=[],cumulativeData=[],dailyPlusBonusValues=[],cumulativePlusBonusData=[];allData.forEach(item=>{cumulativeSum+=item.value;cumulativeSumPlusBonus+=(item.value+bonusValue);labels.push(item.date);dailyValues.push(item.value);cumulativeData.push(cumulativeSum);dailyPlusBonusValues.push(item.value+bonusValue);cumulativePlusBonusData.push(cumulativeSumPlusBonus);});allChartData={labels:labels,dailyValues:dailyValues,cumulativeData:cumulativeData,dailyPlusBonusValues:dailyPlusBonusValues,cumulativePlusBonusData:cumulativePlusBonusData};const finalCumulativeValue=cumulativeSum.toFixed(2);document.getElementById('current-cumulative-value').innerHTML=`**BugÃ¼nkÃ¼ KÃ¼mÃ¼latif DeÄŸer:** ${finalCumulativeValue}`;document.getElementById('trend-analysis').innerHTML=analyzeTrends(dailyValues);}
function openChartsModal(){document.getElementById('charts-modal').style.display='block';chartDaysRange=0;chartDaysOffset=0;document.getElementById('chart-days-input').value=0;document.getElementById('chart-offset-input').value=0;document.getElementById('bonus-input-modal').value=document.getElementById('bonus-input').value;renderCharts();}
function closeChartsModal(){document.getElementById('charts-modal').style.display='none';}
function updateBonusAndRender(){const bonusValue=document.getElementById('bonus-input-modal').value;document.getElementById('bonus-input').value=bonusValue;generateChart().then(()=>renderCharts());}
function adjustChartRange(delta){const input=document.getElementById('chart-days-input');let newValue=parseInt(input.value)||0;newValue+=delta;if(newValue<0)newValue=0;if(allChartData&&newValue>allChartData.labels.length)newValue=allChartData.labels.length;input.value=newValue;applyChartRange();}
function shiftChartView(delta){const input=document.getElementById('chart-offset-input');let newValue=parseInt(input.value)||0;newValue+=delta;if(newValue<0)newValue=0;if(allChartData){const maxOffset=allChartData.labels.length-(chartDaysRange||allChartData.labels.length);if(newValue>maxOffset)newValue=maxOffset;}input.value=newValue;applyChartRange();}
function applyChartRange(){const rangeInput=document.getElementById('chart-days-input'),offsetInput=document.getElementById('chart-offset-input');chartDaysRange=parseInt(rangeInput.value)||0;chartDaysOffset=parseInt(offsetInput.value)||0;if(chartDaysRange<0)chartDaysRange=0;if(chartDaysOffset<0)chartDaysOffset=0;if(allChartData){if(chartDaysRange>allChartData.labels.length)chartDaysRange=allChartData.labels.length;const maxOffset=allChartData.labels.length-(chartDaysRange||allChartData.labels.length);if(chartDaysOffset>maxOffset)chartDaysOffset=maxOffset;}renderCharts();}
function renderCharts(){if(!allChartData)return;const bonusValue=parseFloat(document.getElementById('bonus-input-modal').value)||0.5;let{labels,dailyValues,cumulativeData}=allChartData,displayLabels=labels,displayDaily=dailyValues,displayCumulative=cumulativeData,displayDailyPlus=[],displayCumulativePlus=[];let cumulativeSumPlusBonus=0;dailyValues.forEach((v,i)=>{cumulativeSumPlusBonus+=(v+bonusValue);displayDailyPlus.push(v+bonusValue);displayCumulativePlus.push(cumulativeSumPlusBonus);});if(chartDaysRange>0&&chartDaysRange<labels.length){const startIdx=Math.max(0,labels.length-chartDaysRange-chartDaysOffset),endIdx=labels.length-chartDaysOffset;displayLabels=labels.slice(startIdx,endIdx);displayDaily=dailyValues.slice(startIdx,endIdx);displayCumulative=cumulativeData.slice(startIdx,endIdx);displayDailyPlus=displayDailyPlus.slice(startIdx,endIdx);displayCumulativePlus=displayCumulativePlus.slice(startIdx,endIdx);}else if(chartDaysOffset>0){const startIdx=0,endIdx=labels.length-chartDaysOffset;displayLabels=labels.slice(startIdx,endIdx);displayDaily=dailyValues.slice(startIdx,endIdx);displayCumulative=cumulativeData.slice(startIdx,endIdx);displayDailyPlus=displayDailyPlus.slice(startIdx,endIdx);displayCumulativePlus=displayCumulativePlus.slice(startIdx,endIdx);}const baseOptions={responsive:true,maintainAspectRatio:true,plugins:{legend:{display:false}},scales:{x:{title:{display:true,text:'Tarih',font:{size:12}},grid:{display:false}},y:{title:{display:true,text:'DeÄŸer',font:{size:12}},beginAtZero:false}}};if(chartInstance1)chartInstance1.destroy();const ctx1=document.getElementById('cumulativeChart').getContext('2d');chartInstance1=new Chart(ctx1,{type:'line',data:{labels:displayLabels,datasets:[{label:'KÃ¼mÃ¼latif DeÄŸer',data:displayCumulative,borderColor:'#3498db',backgroundColor:'rgba(52,152,219,0.2)',tension:0.3,fill:true,pointRadius:3,pointBackgroundColor:'#2ecc71',borderWidth:2}]},options:JSON.parse(JSON.stringify(baseOptions))});if(chartInstance2)chartInstance2.destroy();const ctx2=document.getElementById('dailyChart').getContext('2d');chartInstance2=new Chart(ctx2,{type:'bar',data:{labels:displayLabels,datasets:[{label:'GÃ¼nlÃ¼k DeÄŸer',data:displayDaily,backgroundColor:displayDaily.map(v=>v>=0?'rgba(46,204,113,0.6)':'rgba(231,76,60,0.6)'),borderColor:displayDaily.map(v=>v>=0?'#2ecc71':'#e74c3c'),borderWidth:2}]},options:JSON.parse(JSON.stringify(baseOptions))});if(chartInstance3)chartInstance3.destroy();const ctx3=document.getElementById('cumulativePlusChart').getContext('2d');chartInstance3=new Chart(ctx3,{type:'line',data:{labels:displayLabels,datasets:[{label:'KÃ¼mÃ¼latif DeÄŸer (+Bonus)',data:displayCumulativePlus,borderColor:'#9b59b6',backgroundColor:'rgba(155,89,182,0.2)',tension:0.3,fill:true,pointRadius:3,pointBackgroundColor:'#8e44ad',borderWidth:2}]},options:JSON.parse(JSON.stringify(baseOptions))});if(chartInstance4)chartInstance4.destroy();const ctx4=document.getElementById('dailyPlusChart').getContext('2d');chartInstance4=new Chart(ctx4,{type:'bar',data:{labels:displayLabels,datasets:[{label:'GÃ¼nlÃ¼k DeÄŸer (+Bonus)',data:displayDailyPlus,backgroundColor:displayDailyPlus.map(v=>v>=0?'rgba(46,204,113,0.6)':'rgba(231,76,60,0.6)'),borderColor:displayDailyPlus.map(v=>v>=0?'#2ecc71':'#e74c3c'),borderWidth:2}]},options:JSON.parse(JSON.stringify(baseOptions))});}
function sign(x){if(x>0)return 1;if(x<0)return -1;return 0;}
async function openSpecialCalculation(){if(!db){alert("Firebase baÅŸlatÄ±lamadÄ±.");return;}const snapshot=await db.collection(collectionName).orderBy("date","asc").get();if(snapshot.empty){alert("Veri yok. Ã–nce veri girin.");return;}const allData=[];snapshot.forEach(doc=>allData.push(doc.data()));const firstDate=new Date(allData[0].date),today=new Date(),allDates=[],dateMap=new Map();allData.forEach(item=>dateMap.set(item.date,item.value));let currentDate=new Date(firstDate);while(currentDate<=today){const dateStr=currentDate.toISOString().split('T')[0];allDates.push(dateStr);currentDate.setDate(currentDate.getDate()+1);}const labels=[],calculatedValues=[],calculatedValues2=[],missingDates=[];let Tp=0,Bg=0;for(let i=0;i<allDates.length;i++){const date=allDates[i],Tg=i+1,value=dateMap.get(date);if(value!==undefined){Tp+=value;}else{Bg++;missingDates.push(date);}const numerator=2843+4*(Tp+(Tg-Bg))+(Bg*0.5),numeratorDiv365=numerator/365,denomBase=4*((990+Tg)/365),ratio=numeratorDiv365/denomBase,absRatio=Math.abs(ratio),term1=Math.pow(absRatio,1.62),term2=Math.pow(absRatio,0.62),denominator=1+Math.abs(term2-1),result=100*sign(numeratorDiv365)*(term1/denominator),x=(990+Tg)/365,y=(2843+4*(Tp+(Tg-Bg))+(Bg*0.5))/365;labels.push(date);calculatedValues.push(result);calculatedValues2.push({x:x,y:y});}allSpecialData={labels:labels,calculatedValues:calculatedValues,calculatedValues2:calculatedValues2,missingDates:missingDates,finalTg:allDates.length,finalTp:Tp,finalBg:Bg};currentDaysRange=0;currentDaysOffset=0;document.getElementById('days-range-input').value=0;document.getElementById('special-offset-input').value=0;document.getElementById('special-calc-modal').style.display='block';renderSpecialCharts();}
function adjustSpecialRange(delta){const input=document.getElementById('days-range-input');let newValue=parseInt(input.value)||0;newValue+=delta;if(newValue<0)newValue=0;if(allSpecialData&&newValue>allSpecialData.labels.length)newValue=allSpecialData.labels.length;input.value=newValue;applySpecialRange();}
function shiftSpecialView(delta){const input=document.getElementById('special-offset-input');let newValue=parseInt(input.value)||0;newValue+=delta;if(newValue<0)newValue=0;if(allSpecialData){const maxOffset=allSpecialData.labels.length-(currentDaysRange||allSpecialData.labels.length);if(newValue>maxOffset)newValue=maxOffset;}input.value=newValue;applySpecialRange();}
function applySpecialRange(){const rangeInput=document.getElementById('days-range-input'),offsetInput=document.getElementById('special-offset-input');currentDaysRange=parseInt(rangeInput.value)||0;currentDaysOffset=parseInt(offsetInput.value)||0;if(currentDaysRange<0)currentDaysRange=0;if(currentDaysOffset<0)currentDaysOffset=0;if(allSpecialData){if(currentDaysRange>allSpecialData.labels.length)currentDaysRange=allSpecialData.labels.length;const maxOffset=allSpecialData.labels.length-(currentDaysRange||allSpecialData.labels.length);if(currentDaysOffset>maxOffset)currentDaysOffset=maxOffset;}renderSpecialCharts();}
function renderSpecialCharts(){if(!allSpecialData)return;const{labels,calculatedValues,calculatedValues2,missingDates,finalTg,finalTp,finalBg}=allSpecialData,S=parseFloat(document.getElementById('s-parameter-input').value)||12,actualValues2=calculatedValues2.map(item=>{const arctan4=Math.atan(4);return S*(-(item.x*Math.sin(arctan4))+(item.y*Math.cos(arctan4)));});let displayLabels=labels,displayValues=calculatedValues,displayValues2=actualValues2;if(currentDaysRange>0&&currentDaysRange<labels.length){const startIdx=Math.max(0,labels.length-currentDaysRange-currentDaysOffset),endIdx=labels.length-currentDaysOffset;displayLabels=labels.slice(startIdx,endIdx);displayValues=calculatedValues.slice(startIdx,endIdx);displayValues2=actualValues2.slice(startIdx,endIdx);}else if(currentDaysOffset>0){const startIdx=0,endIdx=labels.length-currentDaysOffset;displayLabels=labels.slice(startIdx,endIdx);displayValues=calculatedValues.slice(startIdx,endIdx);displayValues2=actualValues2.slice(startIdx,endIdx);}const formattedLabels=displayLabels.map(date=>{const d=new Date(date),day=String(d.getDate()).padStart(2,'0'),month=String(d.getMonth()+1).padStart(2,'0'),year=String(d.getFullYear()).slice(-2);return `${day}.${month}.${year}`;}),firstValue=displayValues[0],lastValue=displayValues[displayValues.length-1],slope=((lastValue-firstValue)/displayValues.length).toFixed(4),firstValue2=displayValues2[0],lastValue2=displayValues2[displayValues2.length-1],slope2=((lastValue2-firstValue2)/displayValues2.length).toFixed(4),todayValue=calculatedValues[calculatedValues.length-1].toFixed(4),todayValue2=actualValues2[actualValues2.length-1].toFixed(4),lastData=calculatedValues2[calculatedValues2.length-1],arctan4=Math.atan(4),todayCalc1=Math.round(S*(-(lastData.x*Math.sin(arctan4))+(lastData.y*Math.cos(arctan4)))*100)/100,todayCalc2=Math.round(S*((lastData.x*Math.cos(arctan4))+(lastData.y*Math.sin(arctan4)))*100)/100,calc1=((990+finalTg)/365).toFixed(4),calc2=((2843+4*(finalTp+(finalTg-finalBg))+(finalBg*0.5))/365).toFixed(4);document.getElementById('slope-display').innerHTML=`ğŸ“ˆ EÄŸim: <strong>${slope}</strong>`;document.getElementById('today-value-display').innerHTML=`ğŸ“… BugÃ¼nÃ¼n DeÄŸeri: <strong>${todayValue}</strong>`;document.getElementById('slope-display-2').innerHTML=`ğŸ“ˆ EÄŸim: <strong>${slope2}</strong>`;document.getElementById('today-value-display-2').innerHTML=`ğŸ“… BugÃ¼nÃ¼n DeÄŸerleri: <strong>${todayCalc1}</strong> , <strong>${todayCalc2}</strong>`;document.getElementById('calc-result-1').innerHTML=`<strong>${calc1}</strong>`;document.getElementById('calc-result-2').innerHTML=`<strong>${calc2}</strong>`;const missingDatesHtml=missingDates.length>0?missingDates.map(date=>{const d=new Date(date);return `<span class="missing-date-item">${d.getDate()}.${d.getMonth()+1}.${d.getFullYear()}</span>`;}).join(''):'<p style="text-align:center;color:#27ae60;">TÃ¼m gÃ¼nlere veri girilmiÅŸ! ğŸ‰</p>';document.getElementById('missing-dates-list').innerHTML=missingDatesHtml;if(specialChartInstance)specialChartInstance.destroy();const ctx=document.getElementById('specialCalcChart').getContext('2d');specialChartInstance=new Chart(ctx,{type:'line',data:{labels:formattedLabels,datasets:[{label:'Grafik 1 DeÄŸeri',data:displayValues,borderColor:'#e74c3c',backgroundColor:'rgba(231,76,60,0.2)',tension:0.3,fill:true,pointRadius:2,pointBackgroundColor:'#c0392b',borderWidth:2}]},options:{responsive:true,maintainAspectRatio:true,plugins:{legend:{display:true}},scales:{x:{title:{display:true,text:'Tarih',font:{size:12}},grid:{display:false},ticks:{maxRotation:45,minRotation:45,autoSkip:true,maxTicksLimit:20}},y:{title:{display:true,text:'DeÄŸer',font:{size:12}},beginAtZero:false}}}});if(specialChartInstance2)specialChartInstance2.destroy();const ctx2=document.getElementById('specialCalcChart2').getContext('2d');specialChartInstance2=new Chart(ctx2,{type:'line',data:{labels:formattedLabels,datasets:[{label:'Grafik 2 DeÄŸeri',data:displayValues2,borderColor:'#9b59b6',backgroundColor:'rgba(155,89,182,0.2)',tension:0.3,fill:true,pointRadius:2,pointBackgroundColor:'#8e44ad',borderWidth:2}]},options:{responsive:true,maintainAspectRatio:true,plugins:{legend:{display:true}},scales:{x:{title:{display:true,text:'Tarih',font:{size:12}},grid:{display:false},ticks:{maxRotation:45,minRotation:45,autoSkip:true,maxTicksLimit:20}},y:{title:{display:true,text:'DeÄŸer',font:{size:12}},beginAtZero:false}}}});}
function closeSpecialCalculation(){document.getElementById('special-calc-modal').style.display='none';}
async function openPredictionModal(){if(!allChartData){await generateChart();}if(!allChartData){alert("Veri yok.");return;}const bonusValue=parseFloat(document.getElementById('bonus-input').value)||0.5,{dailyValues,cumulativeData}=allChartData,predictions=[1,3,5,7],lastCumulative=cumulativeData[cumulativeData.length-1],avgDaily=dailyValues.reduce((a,b)=>a+b,0)/dailyValues.length,recentAvg=dailyValues.slice(-Math.min(7,dailyValues.length)).reduce((a,b)=>a+b,0)/Math.min(7,dailyValues.length);let html='<h3 style="text-align:center;color:#2c3e50;margin:20px 0;">Grafik 1 & 2: KÃ¼mÃ¼latif ve GÃ¼nlÃ¼k Tahminler</h3><div class="prediction-grid">';predictions.forEach(days=>{const predictedCumulative=(lastCumulative+(recentAvg*days)).toFixed(2),predictedDaily=recentAvg.toFixed(2);html+=`<div class="prediction-card"><h5>+${days} GÃ¼n Sonra</h5><div>KÃ¼mÃ¼latif: <span class="value">${predictedCumulative}</span></div><div>GÃ¼nlÃ¼k Ort: <span class="value">${predictedDaily}</span></div></div>`;});html+='</div>';let cumulativePlusBonus=0;dailyValues.forEach(v=>{cumulativePlusBonus+=(v+bonusValue);});const lastCumulativePlus=cumulativePlusBonus,avgDailyPlus=avgDaily+bonusValue,recentAvgPlus=recentAvg+bonusValue;html+='<h3 style="text-align:center;color:#2c3e50;margin:20px 0;">Grafik 3 & 4: KÃ¼mÃ¼latif ve GÃ¼nlÃ¼k Tahminler (+Bonus)</h3><div class="prediction-grid">';predictions.forEach(days=>{const predictedCumulativePlus=(lastCumulativePlus+(recentAvgPlus*days)).toFixed(2),predictedDailyPlus=recentAvgPlus.toFixed(2);html+=`<div class="prediction-card"><h5>+${days} GÃ¼n Sonra</h5><div>KÃ¼mÃ¼latif: <span class="value">${predictedCumulativePlus}</span></div><div>GÃ¼nlÃ¼k Ort: <span class="value">${predictedDailyPlus}</span></div></div>`;});html+='</div>';if(allSpecialData){const{calculatedValues2,finalTg,finalTp,finalBg}=allSpecialData,S=parseFloat(document.getElementById('s-parameter-input').value)||12;html+='<h3 style="text-align:center;color:#2c3e50;margin:20px 0;">Ã–zel Hesaplama Tahminleri</h3><div class="prediction-grid">';predictions.forEach(days=>{const newTg=finalTg+days,newTp=finalTp,newBg=finalBg,x=(990+newTg)/365,y=(2843+4*(newTp+(newTg-newBg))+(newBg*0.5))/365,arctan4=Math.atan(4),value1=S*(-(x*Math.sin(arctan4))+(y*Math.cos(arctan4))),value2=S*((x*Math.cos(arctan4))+(y*Math.sin(arctan4)));html+=`<div class="prediction-card"><h5>+${days} GÃ¼n Sonra</h5><div>DeÄŸer 1: <span class="value">${value1.toFixed(4)}</span></div><div>DeÄŸer 2: <span class="value">${value2.toFixed(4)}</span></div></div>`;});html+='</div>';}document.getElementById('prediction-content').innerHTML=html;document.getElementById('prediction-modal').style.display='block';}
function closePredictionModal(){document.getElementById('prediction-modal').style.display='none';}
async function openCalendarModal(){if(!db){alert("Firebase baÅŸlatÄ±lamadÄ±.");return;}const snapshot=await db.collection(collectionName).get();calendarData=new Map();snapshot.forEach(doc=>{const data=doc.data();calendarData.set(data.date,data.value);});renderCalendar();document.getElementById('calendar-modal').style.display='block';}
function closeCalendarModal(){document.getElementById('calendar-modal').style.display='none';}
function changeMonth(delta){calendarMonth.setMonth(calendarMonth.getMonth()+delta);renderCalendar();}
function getValueClass(value){if(value===1.25)return 'v125';if(value===1)return 'v1';if(value===0.75)return 'v075';if(value===0.25)return 'v025';if(value===0)return 'v0';if(value===-0.25)return 'vm025';if(value===-0.75)return 'vm075';if(value===-1)return 'vm1';if(value===-1.25)return 'vm125';if(value>0.5)return 'v075';if(value>0)return 'v025';if(value===0)return 'v0';if(value>-0.5)return 'vm025';if(value>-1)return 'vm075';if(value>=-1.25)return 'vm1';return 'no-data';}
function renderCalendar(){const year=calendarMonth.getFullYear(),month=calendarMonth.getMonth(),monthNames=['Ocak','Åubat','Mart','Nisan','MayÄ±s','Haziran','Temmuz','AÄŸustos','EylÃ¼l','Ekim','KasÄ±m','AralÄ±k'];document.getElementById('calendar-month').textContent=`${monthNames[month]} ${year}`;const firstDay=new Date(year,month,1).getDay(),daysInMonth=new Date(year,month+1,0).getDate(),startDay=firstDay===0?6:firstDay-1;let html='';for(let i=0;i<startDay;i++){html+='<div class="calendar-day empty"></div>';}for(let day=1;day<=daysInMonth;day++){const dateStr=`${year}-${String(month+1).padStart(2,'0')}-${String(day).padStart(2,'0')}`,value=calendarData?calendarData.get(dateStr):undefined;let className='calendar-day';if(value===undefined){className+=' no-data';}else{className+=` ${getValueClass(value)}`;}html+=`<div class="${className}" onclick="openEditValue('${dateStr}',${value!==undefined?value:'null'})" title="${value!==undefined?'DeÄŸer: '+value.toFixed(2):'Veri yok - TÄ±kla ekle'}">${day}${value!==undefined?'<br><small>'+value.toFixed(2)+'</small>':''}</div>`;}document.getElementById('calendar-grid').innerHTML=html;}
let editingDate=null,editingValue=0;
function openEditValue(dateStr,currentValue){editingDate=dateStr;editingValue=currentValue!==null?currentValue:0;document.getElementById('edit-date-display').textContent=dateStr;document.getElementById('edit-selected-value').textContent=editingValue.toFixed(2);const container=document.getElementById('edit-button-container');container.innerHTML='';buttonValues.forEach(value=>{const button=document.createElement('button');button.textContent=value.toFixed(2);button.onclick=()=>{editingValue=value;document.getElementById('edit-selected-value').textContent=value.toFixed(2);};container.appendChild(button);});document.getElementById('edit-value-modal').style.display='block';}
function closeEditValueModal(){document.getElementById('edit-value-modal').style.display='none';}
async function saveEditedValue(){if(!db||!editingDate){alert("Hata oluÅŸtu.");return;}try{await db.collection(collectionName).doc(editingDate).set({date:editingDate,value:editingValue,timestamp:firebase.firestore.FieldValue.serverTimestamp()});closeEditValueModal();await openCalendarModal();generateChart();alert(`âœ… ${editingDate} iÃ§in ${editingValue.toFixed(2)} kaydedildi!`);}catch(error){console.error("KayÄ±t hatasÄ±:",error);alert("âŒ KayÄ±t hatasÄ±");}}
async function deleteValue(){if(!db||!editingDate){alert("Hata oluÅŸtu.");return;}if(!confirm(`${editingDate} tarihindeki veriyi silmek istediÄŸinize emin misiniz?`))return;try{await db.collection(collectionName).doc(editingDate).delete();closeEditValueModal();await openCalendarModal();generateChart();alert(`âœ… ${editingDate} tarihi silindi!`);}catch(error){console.error("Silme hatasÄ±:",error);alert("âŒ Silme hatasÄ±");}}
window.onclick=function(event){const specialModal=document.getElementById('special-calc-modal'),chartsModal=document.getElementById('charts-modal'),predictionModal=document.getElementById('prediction-modal'),calendarModal=document.getElementById('calendar-modal'),editModal=document.getElementById('edit-value-modal');if(event.target==specialModal)specialModal.style.display='none';if(event.target==chartsModal)chartsModal.style.display='none';if(event.target==predictionModal)predictionModal.style.display='none';if(event.target==calendarModal)calendarModal.style.display='none';if(event.target==editModal)editModal.style.display='none';}
window.onload=()=>{setupButtons();generateChart();};
</script>
</body>
</html>
