<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>GeliÅŸmiÅŸ Alan GÃ¶rselleÅŸtirici V3</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.js"></script>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #050505; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; color: white; }
        canvas { display: block; touch-action: none; }

        /* HUD Paneli */
        #hud {
            position: fixed; top: 15px; left: 15px;
            background: rgba(0, 0, 0, 0.75);
            padding: 12px; border-radius: 10px;
            font-family: 'Courier New', Courier, monospace; font-size: 13px;
            border: 1px solid rgba(255,255,255,0.2);
            backdrop-filter: blur(8px); pointer-events: none; z-index: 100;
            line-height: 1.5;
        }
        #hud span { color: #00ffcc; font-weight: bold; }
        #hud .mode-indicator { color: #ffcc00; font-size: 11px; text-transform: uppercase; margin-bottom: 5px; display: block; }

        /* SaÄŸ Kontrol Paneli */
        .ui-panel {
            position: fixed; top: 15px; right: 15px;
            display: flex; flex-direction: column; gap: 12px; z-index: 101;
        }

        .btn {
            background: rgba(40, 40, 40, 0.85); border: 1px solid rgba(255,255,255,0.25);
            color: white; width: 50px; height: 50px; border-radius: 12px;
            cursor: pointer; font-size: 22px; backdrop-filter: blur(5px);
            display: flex; align-items: center; justify-content: center;
            transition: all 0.2s;
        }
        .btn:active { transform: scale(0.9); background: rgba(80, 80, 80, 0.9); }
        .btn.active { background: #007bff; border-color: #fff; box-shadow: 0 0 15px rgba(0,123,255,0.5); }

        /* Ayar MenÃ¼sÃ¼ */
        #settings {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(18, 18, 18, 0.98); padding: 25px; border-radius: 20px;
            border: 1px solid #333; width: 90%; max-width: 420px;
            display: none; z-index: 1000; box-shadow: 0 20px 50px rgba(0,0,0,0.9);
            max-height: 85vh; overflow-y: auto;
        }

        label { font-size: 12px; color: #aaa; display: block; margin-top: 10px; }
        input {
            width: 100%; background: #252525; border: 1px solid #444;
            padding: 10px; color: #fff; border-radius: 8px; margin: 5px 0;
            font-family: inherit; box-sizing: border-box;
        }
        input:focus { border-color: #007bff; outline: none; }

        .grid-4 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .checkbox-row { display: flex; align-items: center; gap: 10px; margin-top: 15px; }
        .checkbox-row input { width: auto; margin: 0; }

        .apply-btn {
            width: 100%; background: #28a745; color: white; border: none;
            padding: 15px; border-radius: 10px; font-weight: bold;
            margin-top: 20px; cursor: pointer; font-size: 16px;
        }
    </style>
</head>
<body>

<div id="hud">
    <span class="mode-indicator" id="modeTxt">NAVÄ°GASYON MODU</span>
    <b>FPS:</b> <span id="fpsDisplay">60</span><br>
    <b>Ekran OrtasÄ±:</b> (<span id="hx">0.00</span>, <span id="hy">0.00</span>)<br>
    <div id="targetStats" style="display:none; border-top: 1px solid #444; margin-top: 5px; padding-top: 5px;">
        <b>Ä°mleÃ§ X:</b> <span id="tx">0.00</span><br>
        <b>Ä°mleÃ§ Y:</b> <span id="ty">0.00</span><br>
        <b>DeÄŸer:</b> <span id="tv">0.00</span>
    </div>
</div>

<div class="ui-panel">
    <button class="btn" onclick="toggleMenu()" title="Ayarlar">âš™</button>
    <button class="btn" onclick="manualZoom(1.5)" title="YakÄ±nlaÅŸtÄ±r">+</button>
    <button class="btn" onclick="manualZoom(0.66)" title="UzaklaÅŸtÄ±r">-</button>
    <button class="btn" id="lockBtn" onclick="toggleLockMode()" title="Ä°mleÃ§ Modu">ðŸŽ¯</button>
</div>

<div id="settings">
    <h3 style="margin:0 0 10px 0">Parametreler</h3>
    
    <label>Fonksiyon f(x, y):</label>
    <input type="text" id="eqInput" value="sqrt(x^2 + y^2)">

    <div class="grid-4">
        <div><label>i2 (K. KÄ±rmÄ±zÄ±)</label><input type="number" id="i2" value="0"></div>
        <div><label>i (SarÄ±)</label><input type="number" id="i" value="5"></div>
        <div><label>h (YeÅŸil)</label><input type="number" id="h" value="10"></div>
        <div><label>h2 (Mavi)</label><input type="number" id="h2" value="15"></div>
    </div>
    <label>h3 (Mor)</label>
    <input type="number" id="h3" value="20">

    <div style="border-top: 1px solid #333; margin-top: 15px; padding-top: 5px;">
        <div class="checkbox-row">
            <input type="checkbox" id="boxEnable">
            <label style="margin:0">Kutu Ã‡erÃ§evesini GÃ¶ster</label>
        </div>
        <div class="grid-4">
            <div><label>x1</label><input type="number" id="bx1" value="-2"></div>
            <div><label>x2</label><input type="number" id="bx2" value="2"></div>
            <div><label>y1</label><input type="number" id="by1" value="-2"></div>
            <div><label>y2</label><input type="number" id="by2" value="2"></div>
        </div>
    </div>
    
    <button class="apply-btn" onclick="applySettings()">AYARLARI UYGULA</button>
</div>

<canvas id="canvas"></canvas>

<script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d', { alpha: false });
    
    // Uygulama Durumu
    let config = { 
        eq: "sqrt(x^2 + y^2)", 
        i2: 0, i: 5, h: 10, h2: 15, h3: 20,
        box: { enabled: false, x1: -2, x2: 2, y1: -2, y2: 2 }
    };
    
    let view = { 
        x: 0, y: 0, zoom: 40, 
        isMoving: false, 
        isLocked: false, 
        target: { x: 0, y: 0 } 
    };

    let compiledEq = math.compile(config.eq);
    let renderTimer;
    let fps = 0, lastFrameTime = performance.now();

    // Renk KarÄ±ÅŸtÄ±rma (LERP)
    function interpolateColor(c1, c2, t) {
        return [
            Math.floor(c1[0] + (c2[0] - c1[0]) * t),
            Math.floor(c1[1] + (c2[1] - c1[1]) * t),
            Math.floor(c1[2] + (c2[2] - c1[2]) * t)
        ];
    }

    function getRGB(val) {
        const { i2, i, h, h2, h3 } = config;
        if (val < i2 || val > h3) return [0, 0, 0];

        const colors = {
            darkRed: [130, 0, 0],
            yellow: [255, 255, 0],
            green: [0, 255, 0],
            blue: [0, 0, 255],
            purple: [150, 0, 255]
        };

        if (val < i) {
            return interpolateColor(colors.darkRed, colors.yellow, (val - i2) / (i - i2));
        } else if (val < h) {
            return interpolateColor(colors.yellow, colors.green, (val - i) / (h - i));
        } else if (val < h2) {
            return interpolateColor(colors.green, colors.blue, (val - h) / (h2 - h));
        } else {
            return interpolateColor(colors.blue, colors.purple, (val - h2) / (h3 - h2));
        }
    }

    function render(stepSize = 2) {
        const w = canvas.width;
        const h = canvas.height;
        const zoom = view.zoom;
        const vx = view.x;
        const vy = view.y;

        for (let px = 0; px < w; px += stepSize) {
            for (let py = 0; py < h; py += stepSize) {
                const wx = (px - w / 2) / zoom + vx;
                const wy = -(py - h / 2) / zoom + vy;
                
                try {
                    const val = compiledEq.evaluate({ x: wx, y: wy });
                    const [r, g, b] = getRGB(val);
                    ctx.fillStyle = `rgb(${r},${g},${b})`;
                    ctx.fillRect(px, py, stepSize, stepSize);
                } catch (e) {
                    ctx.fillStyle = "#000";
                    ctx.fillRect(px, py, stepSize, stepSize);
                }
            }
        }
        drawOverlay();
        updateFPS();
    }

    function drawOverlay() {
        const w = canvas.width;
        const h = canvas.height;
        const zoom = view.zoom;

        // Kutu Ã‡erÃ§evesi
        if (config.box.enabled) {
            const bx1 = (config.box.x1 - view.x) * zoom + w / 2;
            const bx2 = (config.box.x2 - view.x) * zoom + w / 2;
            const by1 = -(config.box.y1 - view.y) * zoom + h / 2;
            const by2 = -(config.box.y2 - view.y) * zoom + h / 2;

            ctx.strokeStyle = "rgba(255, 255, 255, 0.8)";
            ctx.lineWidth = 2;
            ctx.strokeRect(bx1, by1, bx2 - bx1, by2 - by1);
        }

        // Ä°mleÃ§ (Target)
        if (view.isLocked) {
            const tx = (view.target.x - view.x) * zoom + w / 2;
            const ty = -(view.target.y - view.y) * zoom + h / 2;

            ctx.beginPath();
            ctx.arc(tx, ty, 8, 0, Math.PI * 2);
            ctx.fillStyle = "white";
            ctx.fill();
            ctx.strokeStyle = "black";
            ctx.lineWidth = 2;
            ctx.stroke();

            // ArtÄ± gÃ¶stergesi
            ctx.beginPath();
            ctx.moveTo(tx - 15, ty); ctx.lineTo(tx + 15, ty);
            ctx.moveTo(tx, ty - 15); ctx.lineTo(tx, ty + 15);
            ctx.strokeStyle = "rgba(255,255,255,0.5)";
            ctx.stroke();
            
            updateTargetHUD();
        }
    }

    function updateTargetHUD() {
        try {
            const val = compiledEq.evaluate({ x: view.target.x, y: view.target.y });
            document.getElementById('tx').innerText = view.target.x.toFixed(2);
            document.getElementById('ty').innerText = view.target.y.toFixed(2);
            document.getElementById('tv').innerText = typeof val === 'number' ? val.toFixed(4) : "N/A";
        } catch(e) {}
    }

    function updateFPS() {
        const now = performance.now();
        fps = Math.round(1000 / (now - lastFrameTime));
        lastFrameTime = now;
        document.getElementById('fpsDisplay').innerText = fps;
        document.getElementById('hx').innerText = view.x.toFixed(2);
        document.getElementById('hy').innerText = view.y.toFixed(2);
    }

    function startMoving() {
        view.isMoving = true;
        clearTimeout(renderTimer);
        render(10); // Hareket anÄ± dÃ¼ÅŸÃ¼k Ã§Ã¶zÃ¼nÃ¼rlÃ¼k
        renderTimer = setTimeout(() => {
            view.isMoving = false;
            render(2); // Durunca yÃ¼ksek Ã§Ã¶zÃ¼nÃ¼rlÃ¼k
        }, 150);
    }

    // Mod DeÄŸiÅŸimi
    function toggleLockMode() {
        view.isLocked = !view.isLocked;
        const btn = document.getElementById('lockBtn');
        const hudExt = document.getElementById('targetStats');
        const modeTxt = document.getElementById('modeTxt');

        if (view.isLocked) {
            btn.classList.add('active');
            hudExt.style.display = 'block';
            modeTxt.innerText = "Ä°MLEC MODU (NAVÄ°GASYON KÄ°LÄ°TLÄ°)";
            view.target.x = view.x;
            view.target.y = view.y;
        } else {
            btn.classList.remove('active');
            hudExt.style.display = 'none';
            modeTxt.innerText = "NAVÄ°GASYON MODU";
        }
        render(2);
    }

    // EtkileÅŸim YÃ¶netimi
    let isDown = false;
    let lastMousePos = { x: 0, y: 0 };

    function handleInput(ex, ey, isClick = false) {
        const w = canvas.width;
        const h = canvas.height;
        
        if (view.isLocked) {
            // Ä°mleci hareket ettir
            view.target.x = (ex - w / 2) / view.zoom + view.x;
            view.target.y = -(ey - h / 2) / view.zoom + view.y;
            render(2);
        } else if (isDown && !isClick) {
            // HaritayÄ± kaydÄ±r
            view.x -= (ex - lastMousePos.x) / view.zoom;
            view.y += (ey - lastMousePos.y) / view.zoom;
            lastMousePos = { x: ex, y: ey };
            startMoving();
        }
    }

    canvas.addEventListener('mousedown', e => { 
        isDown = true; 
        lastMousePos = { x: e.clientX, y: e.clientY };
        handleInput(e.clientX, e.clientY, true);
    });
    window.addEventListener('mouseup', () => isDown = false);
    window.addEventListener('mousemove', e => handleInput(e.clientX, e.clientY));

    // Mobil
    let initialPinchDist = 0;
    canvas.addEventListener('touchstart', e => {
        if (e.touches.length === 1) {
            isDown = true;
            lastMousePos = { x: e.touches[0].clientX, y: e.touches[0].clientY };
            handleInput(e.touches[0].clientX, e.touches[0].clientY, true);
        } else if (e.touches.length === 2) {
            initialPinchDist = Math.hypot(e.touches[0].pageX - e.touches[1].pageX, e.touches[0].pageY - e.touches[1].pageY);
        }
    });
    canvas.addEventListener('touchmove', e => {
        if (e.touches.length === 1) {
            handleInput(e.touches[0].clientX, e.touches[0].clientY);
        } else if (e.touches.length === 2 && !view.isLocked) {
            let dist = Math.hypot(e.touches[0].pageX - e.touches[1].pageX, e.touches[0].pageY - e.touches[1].pageY);
            manualZoom(dist / initialPinchDist);
            initialPinchDist = dist;
        }
        e.preventDefault();
    }, {passive: false});
    window.addEventListener('touchend', () => isDown = false);

    function manualZoom(f) {
        if (view.isLocked) return;
        view.zoom *= f;
        startMoving();
    }

    canvas.addEventListener('wheel', e => {
        manualZoom(e.deltaY > 0 ? 0.8 : 1.25);
        e.preventDefault();
    }, {passive: false});

    // MenÃ¼ FonksiyonlarÄ±
    function toggleMenu() {
        const s = document.getElementById('settings');
        s.style.display = s.style.display === 'block' ? 'none' : 'block';
    }

    function applySettings() {
        try {
            const newEq = document.getElementById('eqInput').value;
            math.evaluate(newEq, {x: 1, y: 1}); // Test compile
            config.eq = newEq;
            compiledEq = math.compile(config.eq);
            
            config.i2 = parseFloat(document.getElementById('i2').value);
            config.i = parseFloat(document.getElementById('i').value);
            config.h = parseFloat(document.getElementById('h').value);
            config.h2 = parseFloat(document.getElementById('h2').value);
            config.h3 = parseFloat(document.getElementById('h3').value);
            
            config.box.enabled = document.getElementById('boxEnable').checked;
            config.box.x1 = parseFloat(document.getElementById('bx1').value);
            config.box.x2 = parseFloat(document.getElementById('bx2').value);
            config.box.y1 = parseFloat(document.getElementById('by1').value);
            config.box.y2 = parseFloat(document.getElementById('by2').value);
            
            toggleMenu();
            render(2);
        } catch(e) {
            alert("Denklem hatasÄ±: " + e.message);
        }
    }

    window.addEventListener('resize', () => {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        render(2);
    });

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    render(2);

</script>
</body>
</html>

